import{a as i0,b as ct}from"../chunks/chunk-B3G4DJQ2.js";var Qt=90*Math.PI/180,H0=Qt*.5,lt=.01,_0=.01,A=15;var h0=.95,s0=.6,A0="#101b2e",w0=5,m0=10,ft=3.33;var z=document.getElementById("view"),p=z.getContext("2d");p.imageSmoothingEnabled=!1;h0&&h0!==1&&(z.width=Math.max(1,Math.round(z.width*h0)),z.height=Math.max(1,Math.round(z.height*h0)));var R=z.width,C=z.height,N=document.getElementById("mini"),F=N.getContext("2d");F.imageSmoothingEnabled=!1;var dt=document.getElementById("hpBar"),ut=document.getElementById("ammoBar"),ht=document.getElementById("hpText"),wt=document.getElementById("ammoText"),mt=document.getElementById("msg"),pt=document.getElementById("btnReset"),Gt=document.getElementById("btnToggleMap");var c={x:3.5,y:3.5,a:0,speed:2,rotSpeed:2.6,health:6,maxHealth:6,ammo:1,hasBlueKey:!1,tenacity:20,maxTenacity:20},L0=.2,K=1,bt=1,jt=99;function Y0(e){K=Math.max(bt,Math.min(jt,e|0||bt))}function v0(){let e=Math.cos(c.a),t=Math.sin(c.a),o=-t*Math.tan(H0),n=e*Math.tan(H0),i=1/(o*t-e*n);return{dirX:e,dirY:t,planeX:o,planeY:n,invDet:i}}function r0(e=64,t=64){let o=document.createElement("canvas");return o.width=e,o.height=t,o}function U(e,t){let o=parseInt(e.slice(1),16),n=o>>16&255,i=o>>8&255,a=o&255,r=s=>i0(((s/255)**2.2+t)*255,0,255)|0;return`#${(r(n)<<16|r(i)<<8|r(a)).toString(16).padStart(6,"0")}`}function G0(e,t,o,n){let i=(o*e.width+t)*4,a=parseInt(n.slice(1),16);e.data[i]=a>>16&255,e.data[i+1]=a>>8&255,e.data[i+2]=a&255,e.data[i+3]=255}function Jt(){let e=r0(),t=e.getContext("2d",{willReadFrequently:!0}),o=e.width,n=e.height,i=t.createImageData(o,n),a=["#7a7a7a","#8a8a8a","#9a9a9a","#6a6a6a"];for(let r=0;r<n;r++)for(let s=0;s<o;s++){let d=r%16===15||s%16===15,f=(Math.sin(s*.18)+Math.cos(r*.12))*.06,h=d?"#222222":a[((s/16|0)+(r/16|0))%a.length];G0(i,s,r,U(h,f))}return t.putImageData(i,0,0),e}function Zt(){let e=r0(),t=e.getContext("2d",{willReadFrequently:!0}),o=e.width,n=e.height,i=t.createImageData(o,n);for(let a=0;a<n;a++)for(let r=0;r<o;r++){let s=r%32===0||a%16===0,d=(Math.sin(r*.12)+Math.cos(a*.17))*.07+(((r^a)&7)/128-.03),h=U(s?"#2a2a2a":"#6a6f73",d);(r*13+a*7)%97===0&&(h=U(h,-.25)),G0(i,r,a,h)}return t.putImageData(i,0,0),e}function te(){let e=r0(),t=e.getContext("2d",{willReadFrequently:!0}),o=e.width,n=e.height,i=t.createImageData(o,n);for(let a=0;a<n;a++)for(let r=0;r<o;r++){let s=Math.sin((r+a)*.18)*.1+Math.cos((r-a)*.14)*.08,d=((r^a<<1)&15)/255-.02,f=U("#2e6a2e",s+d);((r+a*2)%13===0||(r*3-a)%29===0)&&(f=U(f,-.18)),(r*5+a*7)%101===0&&(f=U(f,.18)),G0(i,r,a,f)}return t.putImageData(i,0,0),e}function gt(e="#5b4b2a"){let t=r0(),o=t.getContext("2d",{willReadFrequently:!0}),n=t.width,i=t.height,a=o.createImageData(n,i);for(let r=0;r<i;r++)for(let s=0;s<n;s++){let d=Math.sin(s*.22+Math.cos(r*.05)*.4)*.08+Math.sin(r*.07)*.02;G0(a,s,r,U(e,d))}o.putImageData(a,0,0),o.fillStyle="#3a3a3a",o.fillRect(0,18,n,4),o.fillRect(0,42,n,4),o.fillStyle="#6a6a6a";for(let r=6;r<n;r+=12)o.fillRect(r,19,2,2),o.fillRect(r,43,2,2);return o.strokeStyle="#444",o.lineWidth=2,o.beginPath(),o.arc(46,32,4,0,Math.PI*2),o.stroke(),t}function ee(){let e=r0(),t=e.getContext("2d",{willReadFrequently:!0}),o=e.width,n=e.height;t.fillStyle="#1f1f24",t.fillRect(0,0,o,n);let i=o/2,a=n/2,r=t.createRadialGradient(i,a,4,i,a,28);r.addColorStop(0,"#74CCEA"),r.addColorStop(.5,"#20B2DB"),r.addColorStop(1,"#FFE300"),t.fillStyle=r,t.beginPath(),t.arc(i,a,26,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(255,255,255,0.25)";for(let s=0;s<6;s++){t.beginPath();let d=8+s*3;t.arc(i,a,d,s*.6,s*.6+Math.PI*1.2),t.stroke()}return t.strokeStyle="#3a3a3a",t.lineWidth=4,t.beginPath(),t.arc(i,a,28,0,Math.PI*2),t.stroke(),e}function oe(){let e=gt("#6a4a2a"),t=e.getContext("2d",{willReadFrequently:!0});t.fillStyle="#103b5f",t.fillRect(28,8,8,48),t.fillStyle="#74c8ff";for(let o=12;o<52;o+=8)t.fillRect(30,o,4,2);return e}function ne(){let e=r0(),t=e.getContext("2d",{willReadFrequently:!0}),o=e.width,n=e.height,i=t.createImageData(o,n),a=(l,u,m)=>{let G=parseInt(l.slice(1),16),b=parseInt(u.slice(1),16),g=G>>16&255,B=G>>8&255,x=G&255,S=b>>16&255,E=b>>8&255,X=b&255,v=g+(S-g)*m|0,W=B+(E-B)*m|0,H=x+(X-x)*m|0;return`#${(v<<16|W<<8|H).toString(16).padStart(6,"0")}`},r=1337,s=()=>(r=r*1664525+1013904223>>>0)/4294967295,d=[];for(let l=0;l<7;l++)d.push({x:6+s()*(o-12),y:6+s()*(n-12),r:5+s()*9});let f=[];for(let l=0;l<4;l++){let u=s()*o,m=s()*n,G=s()*Math.PI*2,b=20+s()*28,g=u+Math.cos(G)*b,B=m+Math.sin(G)*b,x=2+s()*2.5;f.push({sx:u,sy:m,ex:g,ey:B,rad:x})}let h=(l,u,m,G,b,g)=>{let B=b-m,x=g-G,S=l-m,E=u-G,X=B*B+x*x||1,v=(S*B+E*x)/X;v=v<0?0:v>1?1:v;let W=m+v*B-l,H=G+v*x-u;return Math.sqrt(W*W+H*H)};for(let l=0;l<n;l++)for(let u=0;u<o;u++){let m=Math.sin(u*.23)*.07+Math.cos(l*.19)*.06,G=Math.sin((u+l)*.09)*.05+Math.cos((u-l)*.08)*.04,b=Math.sin(u*.6+l*.15)*.02+Math.cos(u*.2-l*.5)*.015,g=((u*31^l*17)&31)/255-.03,B=m+G+b,x="#FE6660",S=0;for(let M=0;M<d.length;M++){let D=u-d[M].x,P=l-d[M].y,t0=Math.sqrt(D*D+P*P);t0<d[M].r&&(S=Math.max(S,1-t0/d[M].r))}S>0&&(x=a(x,"#f3e08a",Math.min(.45,S*.6)));let E=0;for(let M=0;M<f.length;M++){let D=h(u,l,f[M].sx,f[M].sy,f[M].ex,f[M].ey),P=1-Math.min(1,D/f[M].rad);P>0&&(E=Math.max(E,P))}E>0&&(x=a(x,"#f3d37a",Math.min(.5,E*.8)));let v=(u*13+l*29)%211===0||(u+l*5&63)===7?-.3:0,W=(u*7-l*11)%197===0?.16:0,H=B+g+v+W;G0(i,u,l,U(x,H))}t.putImageData(i,0,0),t.globalAlpha=.5,t.strokeStyle="#9F0000",t.lineWidth=1;for(let l=0;l<10;l++){t.beginPath();let u=2+l*8;t.moveTo(2,u);for(let m=2;m<o-2;m+=8){let G=u+Math.sin((m+l*7)*.4)*3+(l%2?2:-2);t.lineTo(m,G)}t.stroke()}return t.globalAlpha=1,t.strokeStyle="#7E1A09",t.lineWidth=2,t.strokeRect(1,1,o-2,n-2),e}var re=[null,Jt(),Zt(),te(),gt(),ee(),oe(),ne()],Q=[...re];function xt(e){let o=e.getContext("2d").getImageData(0,0,e.width,e.height),n=[];for(let i=0;i<e.width;i++){let a=new Uint8ClampedArray(e.height*4);for(let r=0;r<e.height;r++){let s=(r*e.width+i)*4,d=r*4;a[d]=o.data[s],a[d+1]=o.data[s+1],a[d+2]=o.data[s+2],a[d+3]=o.data[s+3]}n.push({data:a,h:e.height})}return{cols:n,w:e.width,h:e.height}}var p0=Q.map(e=>e?xt(e):null);function ae(){p0.length=0,Q.forEach(e=>{p0.push(e?xt(e):null)})}async function ie(e){let t=`../assets/gfx/${e}`;return new Promise((o,n)=>{let i=new Image;i.onload=()=>{let a=r0(64,64),r=a.getContext("2d",{willReadFrequently:!0});r.imageSmoothingEnabled=!1,r.drawImage(i,0,0,64,64),o(a)},i.onerror=()=>n(new Error(`Failed to load texture: ${t}`)),i.src=t})}async function yt(){try{await se([{index:1,image:"OfficeWall.png"}]),ae()}catch(e){console.warn("Failed to init backrooms wallpaper:",e)}}async function se(e){if(!Array.isArray(e)){console.warn("Expected an array of { index, image } objects. In loadImagesToReplaceTextures");return}let t=e.map(async(o,n)=>{let{index:i,image:a}=o||{};try{let r=await ie(a);i&&i>=0&&i<Q.length?Q[i]=r:Q.push(r)}catch(r){console.warn(`Failed to load texture "${a}" for index ${i} and dont support replacing with cool gmod missing texture:`,r)}});await Promise.all(t)}var V={x:10,y:8},j={x:3.5,y:3.5},w={MAP:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,2,6,2,0,0,0,0,0,0,0,2,6,2,0,0,1],[1,0,0,0,2,0,2,0,0,0,0,0,0,0,2,0,2,0,0,1],[1,0,0,0,2,2,2,0,0,0,0,0,0,0,2,2,2,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,5,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,3,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,3,3,1,3,3,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,0,0,0,0,0,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,0,2,2,2,0,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,1,0,2,0,2,0,1,0,3,0,0,0,1],[1,0,0,0,0,0,0,0,0,2,6,2,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],MAP_W:-1,MAP_H:-1,cielingColorFront:"",floorColorFront:"",cielingColorBack:"",floorColorBack:""},b0=[{name:"Village",mapLayout:[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,1,1,1,1,1,1,6,6,1,1,1,1,1,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],exitPos:{x:10,y:12},startPos:{x:9.5,y:1.5}},{name:"TowerFloor1",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,3,3,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,3,3,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,1,6,6,1,1,0,0,1,1,6,6,1,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,1,6,6,1,1,1,1,1,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,1,1,1,1,1,1,0,0,0,1,0,0,1],[1,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,4,4,1,1,1,1,1,1,1,1,1]],exitPos:{x:10,y:17},startPos:{x:5.5,y:4.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#000000",floorColorBack:"#000000"},{name:"Gallery",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,0,0,0,3,1],[1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,1],[1,1,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,2,0,0,1],[1,1,1,7,1,1,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,2,0,0,1],[1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,1,0,0,2,0,0,1],[1,1,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,1,0,0,2,0,0,1],[1,1,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,2,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,2,0,0,1],[1,0,2,2,2,2,2,2,2,2,2,0,1,0,1,0,1,0,1,0,0,2,0,0,1],[4,0,2,2,2,2,2,2,2,2,2,0,6,0,6,0,6,0,6,0,0,2,0,0,1],[1,0,2,2,2,2,2,2,2,2,2,0,1,0,1,0,1,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,3,0,0,0,3,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],exitPos:{x:3,y:3},startPos:{x:1.5,y:21.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#ECDE60",floorColorBack:"#000000"},{name:"LongHallways",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,3,3,3,3,0,4,0,3,3,3,3,0,0,0,1,1,1],[1,7,7,1,1,6,1,1,1,6,1,1,1,6,1,1,1,6,1,1,0,0,3,3,3,3,3,0,0,0,3,3,3,3,3,0,0,1,1,1],[1,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,0,1],[1,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,6,0,1],[1,7,7,1,1,6,1,1,1,1,1,1,1,1,1,1,1,6,1,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,0,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,2,2,0,2,2,2,2,6,2,2,2,2,0,2,2,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,3,0,0,0,0,0,3,2,0,0,0,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,0,3,3,3,3,3,0,3,3,3,3,3,0,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,1,0,0,0,0,3,3,3,3,0,3,3,3,3,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,2,3,0,0,0,0,0,3,2,0,0,0,1,0,0,0,0,0,3,3,3,0,3,3,3,0,0,0,0,0,1,1,1],[1,7,7,1,2,2,0,2,2,2,2,6,2,2,2,2,0,2,2,1,0,0,0,0,0,0,3,3,0,3,3,0,0,0,0,0,0,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,1,1,1,1,1,1,6,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1],[1,7,7,1,0,0,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,1,1,1],[1,7,7,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1],[1,7,7,1,0,0,6,0,3,3,3,3,3,3,3,3,3,3,3,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,1,1,1],[1,7,7,1,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,3,3,3,3,3,3,3,3,3,3,3,0,4,0,0,1,1,1],[1,7,7,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1],[1,7,7,1,0,0,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,1,1,1],[1,7,7,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,0,0,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,1,1],[1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],exitPos:{x:1,y:1},startPos:{x:9.5,y:3.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#000000",floorColorBack:"#000000"}];var J=new Float32Array(R);function ce(e,t,o,n,i,a,r,s,d){let f=n-o;if(f<=0)return;e.save(),e.imageSmoothingEnabled=!1;let h=s||0,l=h<0?0:h>i.height?i.height:h,u=d||i.height,m=i.height-l,G=u<0?0:u>m?m:u;if(e.drawImage(i,a,l,1,G,t,o,1,f),r<.999){let g=(r<0?0:r)*255|0;e.globalCompositeOperation="multiply",e.fillStyle=`rgb(${g},${g},${g})`,e.fillRect(t,o,1,f)}e.restore()}var g0=C>>1;function Mt(e,t,o,n,i){let{dirX:a,dirY:r,planeX:s,planeY:d}=t,f=p.createLinearGradient(0,0,0,g0);f.addColorStop(0,w.cielingColorFront||"#6495ED"),w.cielingColorBack&&f.addColorStop(.5,w.cielingColorBack||"#6495ED"),f.addColorStop(.9,A0),p.fillStyle=f,p.fillRect(0,0,R,g0);let h=p.createLinearGradient(0,C,0,g0);h.addColorStop(0,w.floorColorFront||"#054213"),h.addColorStop(.85,w.floorColorBack||"#03210A"),h.addColorStop(.95,A0),p.fillStyle=h,p.fillRect(0,g0,R,g0);let l=p.createLinearGradient(0,0,0,C);l.addColorStop(0,"rgba(16,27,46,0.08)"),l.addColorStop(.5,"rgba(16,27,46,0.16)"),l.addColorStop(1,"rgba(16,27,46,0.20)"),p.save(),p.fillStyle=l,p.fillRect(0,0,R,C),p.restore();for(let u=0;u<R;u++){let m=2*(u+.5)/R-1,G=a+s*m,b=r+d*m;if(G<1e-8&&G>-1e-8&&b<1e-8&&b>-1e-8){J[u]=Number.POSITIVE_INFINITY;continue}let g=1/(G||1e-9),B=1/(b||1e-9),x=c.x|0,S=c.y|0,E=g<0?-g:g,X=B<0?-B:B,v,W,H,M;G<0?(v=-1,H=(c.x-x)*E):(v=1,H=(x+1-c.x)*E),b<0?(W=-1,M=(c.y-S)*X):(W=1,M=(S+1-c.y)*X);let D=0,P=1,t0=!1,Wt=0,qt=0;for(;!t0&&Wt++<256;){if(H<M?(H+=E,x+=v,D=0):(M+=X,S+=W,D=1),A>0){let E0=Math.min(H,M);if(E0>A){t0=!1,P=0,qt=E0;break}}if(x<0||S<0||x>=n||S>=i){t0=!0,P=1;break}let u0=o[S][x];if(u0>0){t0=!0,P=u0;break}}if(P===0){J[u]=Number.POSITIVE_INFINITY;continue}let _;D===0?_=H-E:_=M-X,_=Math.max(lt,_);let Z0=0,Nt=D===0?v:0,Vt=D===1?W:0,tt=Math.abs(Nt*a+Vt*r)>=.9&&Math.abs(m)<=.9&&_<Z0?Z0:_,et=c.x+tt*G,ot=c.y+tt*b,e0;D===0?e0=ot-(ot|0):e0=et-(et|0),e0=e0<0?0:e0>.999999?.999999:e0+1e-6;let nt=p0[P]||p0[4],f0=Q[P],S0=f0?f0.width|0:nt.w|0,o0=e0*S0|0;(D===0&&v>0||D===1&&W<0)&&(o0=S0-o0-1),o0=o0<0?0:o0>=S0?S0-1:o0;let $t=_<_0?_0:_,B0=C/$t|0,P0=(C-B0)/2|0,zt=P0+B0,n0=P0,d0=zt;n0<0&&(n0=0),d0>C&&(d0=C);let rt=d0-n0;if(rt<=0){J[u]=_;continue}let at=(f0?f0.height:nt.h||Q[P]?.height||64)|0,Kt=(n0-P0)*(at/Math.max(1,B0)),Ut=rt*(at/Math.max(1,B0)),it=1/(1+_*.25)*(D?.5:1);if(P===7&&(it*=.8+.2*Math.sin(e*6+u*.05)),ce(p,u,n0,d0,f0,o0,it,Kt,Ut),A>0&&_>A*s0){let u0=A*s0,E0=A,st=Math.min(1,Math.max(0,(_-u0)/Math.max(1e-6,E0-u0)));st>0&&(p.save(),p.globalAlpha=st*.85,p.fillStyle=A0,p.fillRect(u,n0,1,d0-n0),p.restore())}J[u]=_}}function le(e){return C/e}function fe(e,t,o){let{dirY:n,dirX:i,planeY:a,planeX:r,invDet:s}=o,d=s*(n*e-i*t),f=s*(-a*e+r*t);return{transX:d,transY:f}}function de(e,t){return Math.round((R>>1)*(1+e/t))}function ue(e,t=0,o=.5){let n=t*100,r=(C>>1)+(e>>1)+(n|0),s=r-e;return s<0&&(s=0),{startY:s,endY:r}}function he(e){let o=(C>>1)-(e>>1);o<0&&(o=0);let n=o+e;return{startY:o,endY:n}}function C0(e,t){let o=e.x-c.x,n=e.y-c.y,{transX:i,transY:a}=fe(o,n,t);if(a<=.01)return null;let r=de(i,a),s=e&&typeof e.scale=="number"?e.scale:e&&e.img&&typeof e.img.scale=="number"?e.img.scale:1,d=le(a)*s,f=typeof e._hR=="number"?e._hR:Math.round(d),h=.1,l=f;(d>f+h||d<f-h)&&(l=Math.round(d)),e._hR=l;let u=l,m=e.img,G=m&&m.width&&m.height?m.width/m.height:1,b=Math.max(1,Math.round(u*G)),g=u/C,B=(e.floorBias??0)*s*g,x=Math.min(.9,Math.max(.2,s)),S=e.ground?ue(u,B,x):he(u),E=Math.round(r-(b>>1)),X=E+b;return{drawStartX:E,drawEndX:X,drawStartY:S.startY,drawEndY:S.endY,depth:a,size:u,width:X-E}}function x0(e,t,o=1){let n=e.trim().split(`
`).map(l=>l.replace(/\s+/g,"")),i=n.length-1;for(;i>=0&&n[i].split("").every(l=>l===".");)i--;i>=0&&i<n.length-1&&(n=n.slice(0,i+1));let a=n.length,r=n[0].length,s=1,d=document.createElement("canvas");d.width=r,d.height=a;let f=d.getContext("2d");f.imageSmoothingEnabled=!1;let h=f.createImageData(r,a);for(let l=0;l<a;l++)for(let u=0;u<r;u++){let m=n[l][u],G=(l*r+u)*4;if(m==="."){h.data[G+3]=0;continue}let b=t[m]||"#ffffff",g=parseInt(b.slice(1),16);h.data[G]=g>>16&255,h.data[G+1]=g>>8&255,h.data[G+2]=g&255,h.data[G+3]=255}if(f.putImageData(h,0,0),o!==1){let l=document.createElement("canvas");l.width=r*o,l.height=a*o;let u=l.getContext("2d");return u.imageSmoothingEnabled=!1,u.drawImage(d,0,0,l.width,l.height),l.baseline=s,l.scale=o,l}return d.baseline=s,d.scale=1,d}async function we(e,t){return await me(e,t,1)}async function me(e,t=1,o=1){let n=`../assets/gfx/${e}`;return new Promise((i,a)=>{let r=new Image;r.onload=()=>{let s=document.createElement("canvas"),d=r.width,f=r.height;s.width=d*t,s.height=f*t;let h=s.getContext("2d");h.imageSmoothingEnabled=!1,h.drawImage(r,0,0,s.width,s.height),s.baseline=o,s.scale=t,i(s)},r.onerror=()=>a(new Error(`Failed to load sprite: ${n}`)),r.src=n})}var c0,y0,F0,T0,k0,R0;async function St(){y0=y0=x0(`
  ................................
  ..............BB..BB............
  .............BbbbbbbB...........
  ...........BbbbGGGGbbbB.........
  ..........BbbbGGGGGGbbbB........
  .........BbbGGGGGGGGGGbbB.......
  ........BbbGGGgGGGGgGGbbB.......
  ........BbbGGgGyyGgGGGbbB.......
  .......BbbGGGGGGGGGGGGbbB.......
  .......BbbGGGGGGGGGGGGbbB.......
  ......BbbGGGGGGGGGGGGGGbbB......
  ......BbbGGGGgGGGGgGGGGbbB......
  ......BbbGGGGwwwwwwGGGGbbB......
  .....BbbGGGwwwWWkWWwwwGGbbB.....
  .....BbbGGGwwwwkkwwwwGGbbB......
  .....BbbGGGwwwwrwwwwGGGbbB......
  .....BbbGGGwwwwwwwwwGGGbbB......
  .....BbbGGGGwwwwwwwGGGGbbB......
  .....BbbGGGGGGGGGGGGGGGbbB......
  .....BbbGGGGGGGGGGGGGGGbbB......
  ......BbbGGGGGGGGGGGGGbbB.......
  ......BbbGGGGGGGGGGGGGbbB.......
  .......BBbbbgggGGGGgggbbBB......
  ........BBBbbbbbbbbbbbbBBB......
  ................................
  `,{B:"#2c1810",b:"#5c3d2e",g:"#7a6b5c",G:"#a89080",k:"#080508",w:"#e8e0d5",W:"#f5f0e8",r:"#8b4513",y:"#ffeb9c"},4),R0=x0(`
  ............
  ....bbbb....
  ..bbGGGGbb..
  .bGGGGGGGGb.
  .bGGgGGgGGb.
  .bGGGGGGGGb.
  .bGgGGGGgGb.
  .bGGGGGGGGb.
  .bGGgGGgGGb.
  .bGGGGGGGGb.
  .bGgGGGGgGb.
  .bGGGGGGGGb.
  .bGGgGGgGGb.
  .bGGGGGGGGb.
  .bGGgGGgGGb.
  .bGGGGGGGGb.
  ..bbGGGGbb..
  ....bbbb....
  ............
  ............
  `,{k:"#0a0f10",g:"#1b5c3a",G:"#2e874f",s:"#7fffd4",b:"#0e1620"},3),T0=x0(`
  ................
  .....B....B.....
  ....BBBBBBBB....
  ...BBbBBbBBB....
  ...BBbgBgbBB....
  ....BBgggBB.....
  .....kGGGk......
  ....kGGsGGk.....
  ...kGGGGGGGk....
  ...kGGGGGGGk....
  ....kGGGGGk.....
  .....kGGGk......
  .......GG.......
  .......GG.......
  .....GGGGGG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GGggGG.....
  `,{k:"#5a4500",g:"#FFD700",G:"#FFA500",s:"#FFF5CC",b:"#4169E1",B:"#87CEEB"},4),F0=x0(`
  ............r...
  ............rr..
  ...........w..r.
  .......sb.w...rr
  .......bdw...w..
  .......sfd..w...
  ......sfffdw....
  .....sfffffdb...
  ....sfbffffss...
  ...sfbfbffs.....
  ..sfbfbfbs......
  .sfbfbfbs.......
  .sffbfbs........
  ..sffbs.........
  ...sss..........
  ................
  `,{b:"#100904",d:"#8f715b",f:"#5a3b1a",r:"#DC143C",s:"#000000",w:"#4d260a"},3),c0=c0=x0(`
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ........................................................w.......
  ......................................................sww.......
  ..................................................wwwwws........
  ...............................................wwwwwwww.s.......
  ..............................................wwwwww....s.......
  ...........................................wwwwwww......s.......
  ...........................................wwwww........s.......
  ..........................................wwwww..........s......
  .........................................wwwww...........s......
  ........................................wwwwww...........s......
  ........................................wwwww............s......
  .......................................wwwww.............s......
  .......................................wwwww.............s......
  .......................................wwww...............s.....
  ......................................wwwww...............s.....
  ......................................wwww................s.....
  .....................................wwwww................s.....
  .....................................wwwww................s.....
  .....................................wwww.................s.....
  .....................................wwww.................s.....
  ....................................wwwww.................s.....
  ....................................wwww..................s.....
  ....................................wwww..................s.....
  ..............................ssss.wwwww..................s.....
  ..............................sss..wwww...................s.....
  ..............................s.bb.wwww....................s....
  ..............................s..bbwwww....................s....
  ..................................bwwww....................s....
  ..................................bbwww....................s....
  ...................................bbww....................s....
  ..................................wwbbww...................s....
  ..................................wwwbbb....................s...
  ..................................wwwwwbb...................s...
  ...................................wwwwwbb..................s...
  ....................................wwww.bb.................s...
  ....................................wwww..bbb...............s...
  ....................................wwww....bb..............s...
  ....................................wwww.....bb..............s..
  ....................................wwww......bb.............s..
  ...................................wwwww.......bb............s..
  ..................................wwwwww........bbb..........s..
  ..................................wwwwww.........bbb.........ss.
  ..................................wwwwww...........bbrrrrr....s.
  ..................................wwwwww...........fbbbrrrr...s.
  ...................................wwwww...........ffffbbrrr..s.
  ...................................wwwwww...........ffffbbrrr.s.
  ...................................wwwwww...........ffffffbb.ss.
  ...................................wwwwww.............ffff.bbbs.
  ...................................wwwwwww..............ff...bs.
  `,{b:"#5a3b1a",f:"#B8860B",r:"#DC143C",s:"#C0C0C0",w:"#8B4513"},3),k0=await we("apple.png",3)}var T=[];function Bt(e){F.clearRect(0,0,N.width,N.height);let t=6,o=20,n=2,i=Math.floor(o/2),a=Math.max(0,Math.min((c.x|0)-i,w.MAP_W-o)),r=Math.max(0,Math.min((c.y|0)-i,w.MAP_H-o));N.width=n+o*t+n,N.height=n+o*t+n;for(let l=0;l<o;l++)for(let u=0;u<o;u++){let m=r+l,G=a+u,b=w.MAP[m]?.[G]??0,g="#0c1220";b===1?g="#ECDE60":b===2?g="#707a88":b===3?g="#00e676":b===4?g="#996633":b===5?g="#FFE300":b===6?g=" #3561ff":b===7&&(g="#FE6660"),F.fillStyle=g,F.fillRect(n+u*t,n+l*t,t-1,t-1)}for(let l of e){if(!l.alive)continue;let u=n+(l.x-a)*t,m=n+(l.y-r)*t;F.fillStyle=l.type==="entity"?"#ffeb9c":l.type==="barrel"?"#57d694":l.type==="key"?"#6aa2ff":l.type==="food"?"#7fffd4":l.type==="arrows"?"#DC143C":"#ffffff",F.fillRect(u-2,m-2,4,4)}let s=n+(c.x-a)*t,d=n+(c.y-r)*t;F.fillStyle="#e7f3ff",F.beginPath(),F.arc(s,d,2.5,0,ct),F.fill();let f=Math.cos(c.a),h=Math.sin(c.a);F.strokeStyle="#78f3d3",F.beginPath(),F.moveTo(s,d),F.lineTo(s+f*1.5*t,d+h*1.5*t),F.stroke()}function I0(e){if(!Array.isArray(e)||e.length===0)throw new Error("Array must be non-empty.");let t=I(e.length)-1;return e[t]}function I(e){if(e<=0)throw new Error("The maximum value must be greater than 0.");return Math.floor(Math.random()*e)+1}var y=null,a0=null,Y=null,O0=null,Et=null;function W0(){y||(y=new(window.AudioContext||window.webkitAudioContext))}function L({freq:e=440,dur:t=.1,type:o="square",vol:n=.2,slide:i=0}){if(!y)return;let a=y.createOscillator(),r=y.createGain();a.type=o,a.frequency.value=e,r.gain.value=n,a.connect(r).connect(y.destination);let s=y.currentTime;i&&(a.frequency.setValueAtTime(e,s),a.frequency.linearRampToValueAtTime(e+i,s+t)),r.gain.setValueAtTime(n,s),r.gain.exponentialRampToValueAtTime(.001,s+t),a.start(s),a.stop(s+t)}function X0({dur:e=.2,vol:t=.2,lp:o=1200}){if(!y)return;let n=y.createBuffer(1,y.sampleRate*e,y.sampleRate),i=n.getChannelData(0);for(let f=0;f<i.length;f++)i[f]=Math.random()*2-1;let a=y.createBufferSource(),r=y.createGain(),s=y.createBiquadFilter();a.buffer=n,r.gain.value=t,s.type="lowpass",s.frequency.value=o,a.connect(s).connect(r).connect(y.destination);let d=y.currentTime;a.start(d),a.stop(d+e)}var q={shot:()=>{let e=I(50),t=-I(50);L({freq:220+e+t,dur:.05+I(3)/100,type:"square",vol:.25,slide:120}),X0({dur:.03+I(3)/100,vol:.15,lp:800})},pickup:()=>{L({freq:880,dur:.06,type:"triangle",vol:.2}),L({freq:1180,dur:.08,type:"triangle",vol:.18})},explode:()=>{X0({dur:1,vol:.3,lp:800}),L({freq:90,dur:.7,type:"sawtooth",vol:.12,slide:-60})},hurt:()=>{L({freq:140,dur:.12,type:"sawtooth",vol:.2,slide:-50})},killedEntity:()=>{let e=Math.random()*16-8;L({freq:320+e,dur:.26,type:"triangle",vol:.3,slide:-220}),L({freq:480+e,dur:.22,type:"sawtooth",vol:.1,slide:-260}),L({freq:90,dur:.08,type:"sine",vol:.18}),X0({dur:.05,vol:.1,lp:1e3}),setTimeout(()=>{L({freq:170+e,dur:.07,type:"triangle",vol:.16,slide:70})},90)},door:()=>{L({freq:420,dur:.12,type:"square",vol:.15})},portal:()=>{L({freq:600,dur:.5,type:"sawtooth",vol:.2}),L({freq:400,dur:.3,type:"sawtooth",vol:.2,slide:50}),L({freq:600,dur:.5,type:"sawtooth",vol:.2})}};async function pe(e,{volume:t=.15}={}){if(y)try{if(!O0||e!==Et){let n=await(await fetch(e,{cache:"force-cache"})).arrayBuffer();O0=await y.decodeAudioData(n),Et=e}At(),Y=y.createBufferSource(),Y.buffer=O0,Y.loop=!0,a0=y.createGain(),a0.gain.value=t,Y.connect(a0).connect(y.destination),Y.start()}catch(o){try{At();let n=new Audio(e);n.loop=!0,n.volume=Math.max(0,Math.min(1,t)),await n.play(),Y={stop:()=>n.pause(),disconnect:()=>{}},a0=null}catch(n){}}}function At(){try{Y&&Y.stop(0)}catch(e){}if(Y&&Y.disconnect)try{Y.disconnect()}catch(e){}if(a0)try{a0.disconnect()}catch(e){}Y=null,a0=null}var vt=!1;async function q0(){if(!y||Y||vt)return;vt=!0,await pe("../assets/sfx/HexenST02SLowed.ogg",{volume:.12})}function Z(e,t){if(e<0||t<0||e>=w.MAP_W||t>=w.MAP_H)return!0;let o=w.MAP[t|0][e|0];return o===0||o===5?!1:o===7?!c.hasBlueKey:o!==6}function N0(e,t,o){return!!(Z(e,t)||Z(e-o,t)||Z(e+o,t)||Z(e,t-o)||Z(e,t+o))}var V0=0,O=new Set,$0=!1,z0=0,K0=!1;function Tt(e){window.addEventListener("keydown",t=>{O.add(t.code),W0(),q0(),t.code==="Space"&&(t.preventDefault(),Ct()),t.code==="KeyM"&&(t.preventDefault(),N.classList.toggle("visible"))}),window.addEventListener("keyup",t=>O.delete(t.code)),e.addEventListener("mousedown",t=>{t.button===0&&Ct(),$0=!0,z0=t.clientX,W0(),q0()}),window.addEventListener("mouseup",()=>$0=!1),window.addEventListener("mousemove",t=>{if($0){let o=t.clientX-z0;z0=t.clientX,c.a+=o*.0035}}),pt.onclick=()=>Me(),Gt.onclick=()=>N.classList.toggle("visible")}function kt(e){let t=O.has("ShiftLeft")||O.has("ShiftRight"),o=c.speed*(t?2:1)*e,n=c.rotSpeed*e,i=Math.cos(c.a),a=Math.sin(c.a),r=-a,s=i,d=0,f=0;O.has("ArrowLeft")&&(c.a-=n),O.has("ArrowRight")&&(c.a+=n),(O.has("ArrowUp")||O.has("KeyW"))&&(d+=i*o,f+=a*o),(O.has("ArrowDown")||O.has("KeyS"))&&(d-=i*o,f-=a*o),O.has("KeyA")&&(d-=r*o,f-=s*o),O.has("KeyD")&&(d+=r*o,f+=s*o);let h=c.x+d,l=c.y+f;N0(h,c.y,L0)||(c.x=h),N0(c.x,l,L0)||(c.y=l)}function Ct(){let e=!1;c.ammo>0&&(c.ammo--,$(),q.shot(),e=!0);let t=v0(),o=Ge(t);if(!o){e||k("No arrows. Look for quivers.");return}switch(o.type){case"entity":e?(o.alive=!1,k(I0(["Entity murdered!","Entity destroyed!","Entity purged!"])),q.killedEntity()):k("No arrows.");break;case"barrel":e&&(o.alive=!1,be(o.x,o.y,2.5),k("Kaboom!"),q.explode());break;case"key":o.alive=!1,c.hasBlueKey=!0,q.door(),k("Realmchild Growths Destroyed! Find the exit!"),Dt();break;case"food":{o.alive=!1;let n=c.health>=c.maxHealth;n&&(c.maxHealth+=1),c.health=i0(c.health+m0,0,c.maxHealth),k(n?"Became Stronger.":"Health restored."),$(),q.pickup();break}case"arrows":o.alive=!1,c.ammo=Math.min(60,c.ammo+w0),$(),k(`Arrows +${w0}`),q.pickup();break;default:break}}function Rt(){for(let e of T)if(!(!e.alive||Math.hypot(e.x-c.x,e.y-c.y)>=.6))switch(e.type){case"key":e.alive=!1,c.hasBlueKey=!0,q.door(),k("Realmchild Growths Destroyed! Find the exit!"),Dt();break;case"food":e.alive=!1,c.health>=c.maxHealth?(k("Became Stronger"),c.maxHealth+=1,c.health=i0(c.health+m0,0,c.maxHealth)):(c.health=i0(c.health+m0,0,c.maxHealth),k(`Health +${m0}`)),$(),q.pickup();break;case"arrows":e.alive=!1,c.ammo=Math.min(60,c.ammo+w0),$(),q.pickup(),k(`Arrows +${w0}`);break;default:break}}function It(){if(K0)return;let e=c.x|0,t=c.y|0;w.MAP[t][e]===5&&(q.portal(),k(`You escaped! Wave ${K} cleared.`),Y0(K+1),K0=!0,setTimeout(()=>{ye(!0),K0=!1},100))}function Ge(e){let o=document.getElementById("view").width>>1|0,n=J[o]||1e9,i=null,a=1e9;for(let r of T){if(!r.alive)continue;let s=C0(r,e);s&&(A>0&&s.depth>A||o>=s.drawStartX&&o<s.drawEndX&&s.depth<n+.1&&s.depth<a&&(i=r,a=s.depth))}return i}function be(e,t,o){for(let n of T){if(!n.alive)continue;Math.hypot(n.x-e,n.y-t)<o&&(n.alive=!1)}}function M0(e=2){let t=0;for(;t++<200;){let o=(Math.random()*(w.MAP_W-2)|0)+1,n=(Math.random()*(w.MAP_H-2)|0)+1;if(w.MAP[n][o]!==0)continue;let i=o+.5-c.x,a=n+.5-c.y;if(!(Math.hypot(i,a)<e))return{x:o,y:n}}return{x:9,y:9}}function Dt(){let e=w.MAP_W,t=w.MAP_H;for(let o=0;o<t;o++)for(let n=0;n<e;n++)w.MAP[o][n]===7&&(w.MAP[o][n]=0)}function Pt(){let e=V.x,t=V.y;for(let o=t-1;o<=t+1;o++)for(let n=e-1;n<=e+1;n++)n===e&&o===t||(w.MAP[o][n]=7)}function Ht(e){let{barrel:t,enchantedKey:o,food:n,arrowQuiver:i,wolfIdle:a}=e;if(T.length=0,I(100)<50)for(let f=0;f<I(2)*(w.MAP_H/20|0);f++){let h=M0(1);T.push({x:h.x+.5,y:h.y+.5,img:t,type:"barrel",alive:!0,dist:0,ground:!0,scale:.5,floorBias:5})}let r=M0(4);T.push({x:r.x+.5,y:r.y+.5,img:o,type:"key",alive:!0,dist:0,ground:!0,scale:.25,floorBias:35});let s=M0(3);T.push({x:s.x+.5,y:s.y+.5,img:n,type:"food",alive:!0,dist:0,ground:!0,scale:.25,floorBias:35});for(let f=0;f<1+(K/3|0)*(w.MAP_H/20|0);f++)if(f<=1&&I(100)<50||f<1&&c.ammo<=0&&I(100)<80||I(100)<25){let h=M0(3);T.push({x:h.x+.5,y:h.y+.5,img:i,type:"arrows",alive:!0,dist:0,ground:!0,scale:.25,floorBias:35})}let d=Math.min((2+(K-1)*2)*(w.MAP_H/20|0),8);for(let f=0;f<d;f++){let h=M0(3.5);T.push({x:h.x+.5,y:h.y+.5,img:a,type:"entity",alive:!0,dist:0,vx:0,vy:0,hurtCD:0,ground:!0,scale:.5,floorBias:5})}}function $(){dt.style.width=`${c.health/c.maxHealth*100}%`,ut.style.width=`${c.ammo/60*100}%`,ht.textContent=Math.max(0,c.health),wt.textContent=c.ammo}var U0=0,Q0=0,j0=!1,Ft=!1;function k(e){let t=document.getElementById("gameLog"),o=t?.querySelector(".log-items");if(!o)return;let n=document.createElement("div");n.textContent=e,o.prepend(n),t.classList.contains("collapsed")||requestAnimationFrame(()=>{o.scrollTop=0})}function _t(e){U0>0&&(U0-=e,U0<=0&&(mt.textContent=c.hasBlueKey?"Find the exit.":"Find the enchanted key."))}function ge(){j0||c.health<=0&&(j0=!0,c.speed=0,c.rotSpeed=0,Q0=2,k("YOU DIED! Soul disconnecting from the node..."))}function Lt(e){j0&&(Q0-=e,Q0<=0&&xe())}function xe(){if(Ft)return;Ft=!0;let e=document.getElementById("game");if(e){let t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.background="#ff0000",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="999999",t.style.fontFamily='"Courier New", monospace',t.style.opacity="0",t.style.transition="opacity 2s ease-in",t.innerHTML=`
      <div style="
        background: #000;
        border: 3px solid #04650d;
        color: #20b2db;
        width: 600px;
        max-width: 90vw;
        box-shadow: 0 0 20px #04650d;
        font-family: 'Courier New', monospace;
      ">
        <div style="
          background:#000;
          color: #04650d;
          padding: 8px 15px;
          display: flex;
          justify-content: space-between;
          font-weight: bold;
          font-size: 12px;
        ">
          <span style ="color: #FFFFFF; border: 1px solid #04650d;">Death...</span>
        </div>
        <div style="padding: 20px; min-height: 200px;">
          <div style="margin-bottom: 30px;">
            <div style="text-align: center; color: #FFFFFF; font-size: 32px; margin: 8px 0;">YOU HAVE DIED</div>
          </div>
          <div style="text-align: center; margin-top: 20px;">
            <button id="returnBtn" style="
              background: #000;
              border: 2px solid #04650d;
              color: #04650d;
              padding: 12px 24px;
              font-family: 'Courier New', monospace;
              font-size: 14px;
              font-weight: bold;
              cursor: pointer;
              text-transform: uppercase;
              letter-spacing: 1px;
            ">RETURN TO TERMINAL</button>
          </div>
        </div>
      </div>
    `,document.body.appendChild(t);let o=t.querySelector("#returnBtn");if(o){let n=!1;o.addEventListener("click",i=>{i.preventDefault(),!n&&(n=!0,setTimeout(()=>{window.location.href="../index.html"},100))})}setTimeout(()=>{t.style.opacity="1"},50),e.classList.add("game-paused"),O.clear()}}function J0(e=!1){e&&l0(),c.x=j.x,c.y=j.y,c.a=0,c.hasBlueKey=!1,w.MAP[V.y][V.x]=5,Pt(),Ht({wolfIdle:y0,barrel:R0,enchantedKey:T0,food:k0,arrowQuiver:F0}),$(),k(`Wave ${K}: Find the enchanted key.`)}function ye(e=!1){e&&(V0>=b0.length-1?l0():(V0+=1,l0(V0))),c.x=j.x,c.y=j.y,c.a=0,c.hasBlueKey=!1,w.MAP[V.y][V.x]=5,Pt(),Ht({wolfIdle:y0,barrel:R0,enchantedKey:T0,food:k0,arrowQuiver:F0}),$(),k(`Wave ${K}: Find the enchanted key.`)}function Me(){Y0(1),l0(0),J0()}function Yt(e){for(let t of T)if(t.alive)switch(t.type){case"entity":let o=c.x-t.x,n=c.y-t.y,i=Math.hypot(o,n);if(i>.3){let a=.9*e,r=o/i,s=n/i,d=t.x+r*a,f=t.y+s*a;Z(d,t.y)||(t.x=d),Z(t.x,f)||(t.y=f)}i<.6&&t.hurtCD<=0&&(c.health=Math.max(0,c.health-ft)|0,$(),k("Entity attacks!"),q.hurt(),t.hurtCD=.8,ge()),t.hurtCD>0&&(t.hurtCD-=e);break;default:break}}var Ot=performance.now();Tt(z);var D0=0;function Se(e){let t=`FPS: ${Math.round(e)}`;p.save(),p.font="12px monospace",p.textAlign="right",p.textBaseline="top";let o=R-8,n=6,i=p.measureText(t).width+8,a=16;p.fillStyle="rgba(10, 15, 25, 0.6)",p.fillRect(o-i,n-2,i,a),p.strokeStyle="rgba(60, 80, 130, 0.9)",p.strokeRect(o-i+.5,n-2+.5,i-1,a-1),p.fillStyle="#dfe6ff",p.fillText(t,o,n),p.restore()}function l0(e=-1){let t;if(e!==-1){let o=b0[e];o&&(t=o)}else t=I0(b0);V.x=t.exitPos.x,V.y=t.exitPos.y,j.x=t.startPos.x,j.y=t.startPos.y,c.health=c.maxHealth,w.cielingColorFront=t.cielingColorFront||"#6495ED",w.floorColorFront=t.floorColorFront||"#054213",w.cielingColorBack=t.cielingColorBack||"#6495ED",w.floorColorBack=t.floorColorBack||"#03210A",w.MAP=t.mapLayout,w.MAP_W=w.MAP[0].length,w.MAP_H=w.MAP.length,c.x=c.x=t.startPos.x,c.y=t.startPos.y}async function Be(){await St(),await yt(),l0(0),J0(),c.maxHealth=6+I(6),c.health=c.maxHealth,c.ammo=5+I(5),$(),requestAnimationFrame(Xt)}function Ee(e){let t=v0();Mt(e,t,w.MAP,w.MAP_W,w.MAP_H),Ae(),T.sort((o,n)=>n.dist-o.dist),p.imageSmoothingEnabled=!1,ve(t),Te()}function Ae(){for(let e of T){let t=e.x-c.x,o=e.y-c.y;e.dist=t*t+o*o}}function ve(e){for(let t of T){if(!t.alive)continue;let o=C0(t,e);if(!o||A>0&&o.depth>A)continue;let n=Ce(o);Fe(t,o,n)}}function Ce(e){let t=1/(1+e.depth*.3);if(A>0&&e.depth>A*s0){let i=A*s0,a=Math.min(1,Math.max(0,(e.depth-i)/Math.max(1e-6,A-i)));t*=1-a*.6}let o=[1,.85,.7,.55,.4];return{quantizedShade:o.reduce((i,a)=>Math.abs(a-t)<Math.abs(i-t)?a:i,o[0])}}function Fe(e,t,o){p.save(),o.quantizedShade<.999&&(p.filter=`brightness(${o.quantizedShade})`);let n=Math.max(1,(t.width??t.drawEndX-t.drawStartX)|0),i=t.drawStartY,a=t.drawEndY-t.drawStartY,r=f=>(f-t.drawStartX)*e.img.width/n|0,s=-1,d=0;for(let f=t.drawStartX;f<=t.drawEndX;f++){let l=f>=0&&f<R&&f<t.drawEndX&&t.depth<=J[f];if(l&&s===-1&&(s=f,d=r(f)),(!l||f===t.drawEndX)&&s!==-1){let u=f,m=u-s,G=r(u);G<=d&&(G=d+1);let b=Math.min(e.img.width-d,G-d);m>0&&b>0&&a>0&&p.drawImage(e.img,d,0,b,e.img.height,s,i,m,a),s=-1}}p.restore()}function Te(){let e=Math.round(R*.42),t=Math.round(e*(c0.height/c0.width)),o=Math.max(8,R*.02|0),n=R*.8-e-o,i=C-t-o+20;p.drawImage(c0,n,i,e,t)}function Xt(e){let t=Math.min(.05,(e-Ot)/1e3);Ot=e;let o=t>0?1/t:0;D0=D0?D0*.9+o*.1:o,kt(t),Yt(t),Rt(),Ee(e/1e3),N.classList.contains("visible")&&Bt(T),It(),_t(t),Lt(t),Se(D0),requestAnimationFrame(Xt)}await Be().catch(console.error);export{l0 as ChangeMapLevel};
