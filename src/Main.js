import{a as r0,b as wt}from"../chunks/chunk-B3G4DJQ2.js";var pe=90*Math.PI/180,Y0=pe*.5,gt=.01,X0=.01,E=15;var u0=.95,B0=.75,a0=.6,C0="#101b2e",p0=5,h0=10,bt=3.33;var q=document.getElementById("view"),g=q.getContext("2d");g.imageSmoothingEnabled=!1;u0&&u0!==1&&(q.width=Math.max(1,Math.round(q.width*u0)),q.height=Math.max(1,Math.round(q.height*u0)));var B=q.width,S=q.height,L=document.getElementById("mini"),C=L.getContext("2d");C.imageSmoothingEnabled=!1;var Gt=document.getElementById("hpBar"),yt=document.getElementById("ammoBar"),xt=document.getElementById("hpText"),Et=document.getElementById("ammoText"),St=document.getElementById("msg"),Mt=document.getElementById("btnReset"),Bt=document.getElementById("btnToggleMap");var l={x:3.5,y:3.5,a:0,speed:2,rotSpeed:2.6,health:6,maxHealth:6,ammo:1,hasBlueKey:!1,tenacity:20,maxTenacity:20},W0=.2,V=1,Ct=1,he=99;function N0(t){V=Math.max(Ct,Math.min(he,t|0||Ct))}function A0(){let t=Math.cos(l.a),e=Math.sin(l.a),o=-e*Math.tan(Y0),n=t*Math.tan(Y0),a=1/(o*e-t*n);return{dirX:t,dirY:e,planeX:o,planeY:n,invDet:a}}function e0(t=64,e=64){let o=document.createElement("canvas");return o.width=t,o.height=e,o}function z(t,e){let o=parseInt(t.slice(1),16),n=o>>16&255,a=o>>8&255,r=o&255,i=s=>r0(((s/255)**2.2+e)*255,0,255)|0;return`#${(i(n)<<16|i(a)<<8|i(r)).toString(16).padStart(6,"0")}`}function w0(t,e,o,n){let a=(o*t.width+e)*4,r=parseInt(n.slice(1),16);t.data[a]=r>>16&255,t.data[a+1]=r>>8&255,t.data[a+2]=r&255,t.data[a+3]=255}function me(){let t=e0(),e=t.getContext("2d",{willReadFrequently:!0}),o=t.width,n=t.height,a=e.createImageData(o,n),r=["#7a7a7a","#8a8a8a","#9a9a9a","#6a6a6a"];for(let i=0;i<n;i++)for(let s=0;s<o;s++){let c=i%16===15||s%16===15,f=(Math.sin(s*.18)+Math.cos(i*.12))*.06,m=c?"#222222":r[((s/16|0)+(i/16|0))%r.length];w0(a,s,i,z(m,f))}return e.putImageData(a,0,0),t}function we(){let t=e0(),e=t.getContext("2d",{willReadFrequently:!0}),o=t.width,n=t.height,a=e.createImageData(o,n);for(let r=0;r<n;r++)for(let i=0;i<o;i++){let s=i%32===0||r%16===0,c=(Math.sin(i*.12)+Math.cos(r*.17))*.07+(((i^r)&7)/128-.03),m=z(s?"#2a2a2a":"#6a6f73",c);(i*13+r*7)%97===0&&(m=z(m,-.25)),w0(a,i,r,m)}return e.putImageData(a,0,0),t}function ge(){let t=e0(),e=t.getContext("2d",{willReadFrequently:!0}),o=t.width,n=t.height,a=e.createImageData(o,n);for(let r=0;r<n;r++)for(let i=0;i<o;i++){let s=Math.sin((i+r)*.18)*.1+Math.cos((i-r)*.14)*.08,c=((i^r<<1)&15)/255-.02,f=z("#2e6a2e",s+c);((i+r*2)%13===0||(i*3-r)%29===0)&&(f=z(f,-.18)),(i*5+r*7)%101===0&&(f=z(f,.18)),w0(a,i,r,f)}return e.putImageData(a,0,0),t}function At(t="#5b4b2a"){let e=e0(),o=e.getContext("2d",{willReadFrequently:!0}),n=e.width,a=e.height,r=o.createImageData(n,a);for(let i=0;i<a;i++)for(let s=0;s<n;s++){let c=Math.sin(s*.22+Math.cos(i*.05)*.4)*.08+Math.sin(i*.07)*.02;w0(r,s,i,z(t,c))}o.putImageData(r,0,0),o.fillStyle="#3a3a3a",o.fillRect(0,18,n,4),o.fillRect(0,42,n,4),o.fillStyle="#6a6a6a";for(let i=6;i<n;i+=12)o.fillRect(i,19,2,2),o.fillRect(i,43,2,2);return o.strokeStyle="#444",o.lineWidth=2,o.beginPath(),o.arc(46,32,4,0,Math.PI*2),o.stroke(),e}function be(){let t=e0(),e=t.getContext("2d",{willReadFrequently:!0}),o=t.width,n=t.height;e.fillStyle="#1f1f24",e.fillRect(0,0,o,n);let a=o/2,r=n/2,i=e.createRadialGradient(a,r,4,a,r,28);i.addColorStop(0,"#74CCEA"),i.addColorStop(.5,"#20B2DB"),i.addColorStop(1,"#FFE300"),e.fillStyle=i,e.beginPath(),e.arc(a,r,26,0,Math.PI*2),e.fill(),e.strokeStyle="rgba(255,255,255,0.25)";for(let s=0;s<6;s++){e.beginPath();let c=8+s*3;e.arc(a,r,c,s*.6,s*.6+Math.PI*1.2),e.stroke()}return e.strokeStyle="#3a3a3a",e.lineWidth=4,e.beginPath(),e.arc(a,r,28,0,Math.PI*2),e.stroke(),t}function Ge(){let t=At("#6a4a2a"),e=t.getContext("2d",{willReadFrequently:!0});e.fillStyle="#103b5f",e.fillRect(28,8,8,48),e.fillStyle="#74c8ff";for(let o=12;o<52;o+=8)e.fillRect(30,o,4,2);return t}function ye(){let t=e0(),e=t.getContext("2d",{willReadFrequently:!0}),o=t.width,n=t.height,a=e.createImageData(o,n),r="#00D9FF",i=5,s=.6,c=.1,f=.04,m=.5,d=.8660254,w=o*.5,b=n*.5,G=Math.min(o,n);for(let u=0;u<n;u++)for(let h=0;h<o;h++){let T=h/i,X=(h*m+u*d)/i,W=(h*m-u*d)/i,O=1-Math.abs(Math.sin(Math.PI*T)),H=1-Math.abs(Math.sin(Math.PI*X)),$=1-Math.abs(Math.sin(Math.PI*W)),_=(O+H+$)/3,D=1-Math.min(h,u,o-1-h,n-1-u)/(G*.5);D<0&&(D=0);let n0=(h*13+u*17)%23/23-.5,_0=_*s+D*c+n0*f;w0(a,h,u,z(r,_0))}e.putImageData(a,0,0),e.globalAlpha=.35,e.strokeStyle="#6FEAFF",e.lineWidth=1;for(let u=0;u<9;u++){e.beginPath();let h=3+u*Math.floor(n/10);e.moveTo(2,h);for(let T=2;T<o-2;T+=6){let X=h+Math.sin((T+u*7)*.35)*2.5+Math.sin((T*.5-u*9)*.12)*1.5;e.lineTo(T,X)}e.stroke()}return t}var xe=[null,me(),we(),ge(),At(),be(),Ge(),ye()],K=[...xe];function Ft(t){let o=t.getContext("2d").getImageData(0,0,t.width,t.height),n=[];for(let a=0;a<t.width;a++){let r=new Uint8ClampedArray(t.height*4);for(let i=0;i<t.height;i++){let s=(i*t.width+a)*4,c=i*4;r[c]=o.data[s],r[c+1]=o.data[s+1],r[c+2]=o.data[s+2],r[c+3]=o.data[s+3]}n.push({data:r,h:t.height})}return{cols:n,w:t.width,h:t.height}}var m0=K.map(t=>t?Ft(t):null);function Ee(){m0.length=0,K.forEach(t=>{m0.push(t?Ft(t):null)})}async function Se(t){let e=`../assets/gfx/${t}`;return new Promise((o,n)=>{let a=new Image;a.onload=()=>{let r=e0(64,64),i=r.getContext("2d",{willReadFrequently:!0});i.imageSmoothingEnabled=!1,i.drawImage(a,0,0,64,64),o(r)},a.onerror=()=>n(new Error(`Failed to load texture: ${e}`)),a.src=e})}async function Tt(){try{await Me([{index:1,image:"OfficeWall.png"},{index:2,image:"Panel.png"},{index:3,image:"Hedge.png"},{index:4,image:"OfficeDoor.png"},{index:5,image:"Portal.png"},{index:6,image:"OfficeDoorBlue.png"},{index:7,image:"Field.png"}]),Ee()}catch(t){console.warn("Failed to init backrooms wallpaper:",t)}}async function Me(t){if(!Array.isArray(t)){console.warn("Expected an array of { index, image } objects. In loadImagesToReplaceTextures");return}let e=t.map(async(o,n)=>{let{index:a,image:r}=o||{};try{let i=await Se(r);a&&a>=0&&a<K.length?K[a]=i:K.push(i)}catch(i){console.warn(`Failed to load texture "${r}" for index ${a} and dont support replacing with cool gmod missing texture:`,i)}});await Promise.all(e)}var N={x:10,y:8},U={x:3.5,y:3.5},p={MAP:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,2,6,2,0,0,0,0,0,0,0,2,6,2,0,0,1],[1,0,0,0,2,0,2,0,0,0,0,0,0,0,2,0,2,0,0,1],[1,0,0,0,2,2,2,0,0,0,0,0,0,0,2,2,2,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,5,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,3,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,3,3,1,3,3,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,0,0,0,0,0,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,0,2,2,2,0,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,1,0,2,0,2,0,1,0,3,0,0,0,1],[1,0,0,0,0,0,0,0,0,2,6,2,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],MAP_W:-1,MAP_H:-1,cielingColorFront:"",floorColorFront:"",cielingColorBack:"",floorColorBack:""},g0=[{name:"Village",mapLayout:[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,1,2,3,4,5,6,7,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,1,1,1,1,1,6,1,1,6,1,1,1,1,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],exitPos:{x:10,y:12},startPos:{x:9.5,y:1.5}},{name:"TowerFloor1",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,3,3,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,3,3,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,6,1,1,1,1,0,0,1,6,1,1,1,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,1,1,6,1,1,1,1,1,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,1,1,1,1,1,1,0,0,0,1,0,0,1],[1,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,4,4,1,1,1,1,1,1,1,1,1]],exitPos:{x:10,y:17},startPos:{x:5.5,y:4.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#000000",floorColorBack:"#000000"},{name:"Gallery",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,0,0,0,3,1],[1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,1],[1,1,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,2,0,0,1],[1,1,1,7,1,1,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,6],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,2,0,0,1],[1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,1,0,0,2,0,0,1],[1,1,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,1,0,0,2,0,0,1],[1,1,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,2,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,2,0,0,1],[1,0,2,2,2,2,2,2,2,2,2,0,1,0,1,0,1,0,1,0,0,2,0,0,1],[4,0,2,2,2,2,2,2,2,2,2,0,6,0,6,0,6,0,6,0,0,2,0,0,1],[1,0,2,2,2,2,2,2,2,2,2,0,1,0,1,0,1,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,3,0,0,0,3,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],exitPos:{x:3,y:3},startPos:{x:1.5,y:21.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#ECDE60",floorColorBack:"#000000"},{name:"LongHallways",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,3,3,3,3,0,4,0,3,3,3,3,0,0,0,1,1,1],[1,7,7,1,1,6,1,1,1,6,1,1,1,6,1,1,1,6,1,1,0,0,3,3,3,3,3,0,0,0,3,3,3,3,3,0,0,1,1,1],[1,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,0,1],[1,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,6,0,1],[1,7,7,1,1,6,1,1,1,1,1,1,1,1,1,1,1,6,1,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,0,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,2,2,0,2,2,2,2,6,2,2,2,2,0,2,2,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,3,0,0,0,0,0,3,2,0,0,0,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,0,3,3,3,3,3,0,3,3,3,3,3,0,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,1,0,0,0,0,3,3,3,3,0,3,3,3,3,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,2,3,0,0,0,0,0,3,2,0,0,0,1,0,0,0,0,0,3,3,3,0,3,3,3,0,0,0,0,0,1,1,1],[1,7,7,1,2,2,0,2,2,2,2,6,2,2,2,2,0,2,2,1,0,0,0,0,0,0,3,3,0,3,3,0,0,0,0,0,0,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,1,1,1,1,1,1,6,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1],[1,7,7,1,0,0,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,1,1,1],[1,7,7,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1],[1,7,7,1,0,0,6,0,3,3,3,3,3,3,3,3,3,3,3,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,1,1,1],[1,7,7,1,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,3,3,3,3,3,3,3,3,3,3,3,0,4,0,0,1,1,1],[1,7,7,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1],[1,7,7,1,0,0,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,1,1,1],[1,7,7,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,0,0,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,1,1],[1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],exitPos:{x:1,y:1},startPos:{x:9.5,y:3.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#000000",floorColorBack:"#000000"}];var j=new Float32Array(B);function Be(t,e,o,n,a,r,i,s,c){let f=n-o;if(f<=0)return;t.save(),t.imageSmoothingEnabled=!1;let m=s||0,d=m<0?0:m>a.height?a.height:m,w=c||a.height,b=a.height-d,G=w<0?0:w>b?b:w;if(t.drawImage(a,r,d,1,G,e,o,1,f),i<.999){let h=(i<0?0:i)*255|0;t.globalCompositeOperation="multiply",t.fillStyle=`rgb(${h},${h},${h})`,t.fillRect(e,o,1,f)}t.restore()}var b0=S>>1;function vt(t){let e=t.createLinearGradient(0,0,0,b0);e.addColorStop(0,p.cielingColorFront||"#6495ED"),p.cielingColorBack&&e.addColorStop(.5,p.cielingColorBack||"#6495ED"),e.addColorStop(.9,C0),t.fillStyle=e,t.fillRect(0,0,B,b0)}function Rt(t){let e=t.createLinearGradient(0,S,0,b0);e.addColorStop(0,p.floorColorFront||"#054213"),e.addColorStop(.85,p.floorColorBack||"#03210A"),e.addColorStop(.95,C0),t.fillStyle=e,t.fillRect(0,b0,B,b0)}function It(t){let e=t.createLinearGradient(0,0,0,S);e.addColorStop(0,"rgba(16,27,46,0.08)"),e.addColorStop(.5,"rgba(16,27,46,0.16)"),e.addColorStop(1,"rgba(16,27,46,0.20)"),t.save(),t.fillStyle=e,t.fillRect(0,0,B,S),t.restore()}function kt(t,e,o,n,a){let{dirX:r,dirY:i,planeX:s,planeY:c}=e;for(let f=0;f<B;f++){let m=2*(f+.5)/B-1,d=r+s*m,w=i+c*m;if(d<1e-8&&d>-1e-8&&w<1e-8&&w>-1e-8){j[f]=Number.POSITIVE_INFINITY;continue}let b=1/(d||1e-9),G=1/(w||1e-9),u=l.x|0,h=l.y|0,T=b<0?-b:b,X=G<0?-G:G,W,O,H,$;d<0?(W=-1,H=(l.x-u)*T):(W=1,H=(u+1-l.x)*T),w<0?(O=-1,$=(l.y-h)*X):(O=1,$=(h+1-l.y)*X);let _=0,D=1,n0=!1,_0=0,ie=0;for(;!n0&&_0++<256;){if(H<$?(H+=T,u+=W,_=0):($+=X,h+=O,_=1),E>0){let M0=Math.min(H,$);if(M0>E){n0=!1,D=0,ie=M0;break}}if(u<0||h<0||u>=n||h>=a){n0=!0,D=1;break}let d0=o[h][u];if(d0>0){n0=!0,D=d0;break}}if(D===0){j[f]=Number.POSITIVE_INFINITY;continue}let v;_===0?v=H-T:v=$-X,v=Math.max(gt,v);let st=0,se=_===0?W:0,le=_===1?O:0,lt=Math.abs(se*r+le*i)>=.9&&Math.abs(m)<=.9&&v<st?st:v,ct=l.x+lt*d,ft=l.y+lt*w,J;_===0?J=ft-(ft|0):J=ct-(ct|0),J=J<0?0:J>.999999?.999999:J+1e-6;let dt=m0[D]||m0[4],c0=K[D],E0=c0?c0.width|0:dt.w|0,Z=J*E0|0;(_===0&&W>0||_===1&&O<0)&&(Z=E0-Z-1),Z=Z<0?0:Z>=E0?E0-1:Z;let ce=v<X0?X0:v,S0=S/ce|0,L0=(S-S0*B0)/2|0,fe=L0+S0,t0=L0,f0=fe;t0<0&&(t0=0),f0>S&&(f0=S);let ut=f0-t0;if(ut<=0){j[f]=v;continue}let pt=(c0?c0.height:dt.h||K[D]?.height||64)|0,de=(t0-L0)*(pt/Math.max(1,S0)),ue=ut*(pt/Math.max(1,S0)),ht=1/(1+v*.25)*(_?.5:1);if(D===7&&(ht*=.8+.2*Math.sin(t*6+f*.05)),Be(g,f,t0,f0,c0,Z,ht,de,ue),E>0&&v>E*a0){let d0=E*a0,M0=E,mt=Math.min(1,Math.max(0,(v-d0)/Math.max(1e-6,M0-d0)));mt>0&&(g.save(),g.globalAlpha=mt*.85,g.fillStyle=C0,g.fillRect(f,t0,1,f0-t0),g.restore())}j[f]=v}}function Ce(t){return S/t}function Ae(t,e,o){let{dirY:n,dirX:a,planeY:r,planeX:i,invDet:s}=o,c=s*(n*t-a*e),f=s*(-r*t+i*e);return{transX:c,transY:f}}function Fe(t,e){return Math.round((B>>1)*(1+t/e))}function Te(t,e=0,o=.5){let n=e*100,i=(S>>1)+(t>>1)+(n|0),s=i-t;return s<0&&(s=0),{startY:s,endY:i}}function ve(t){let o=(S>>1)-(t>>1);o<0&&(o=0);let n=o+t;return{startY:o,endY:n}}function F0(t,e){let o=t.x-l.x,n=t.y-l.y,{transX:a,transY:r}=Ae(o,n,e);if(r<=.01)return null;let i=Fe(a,r),s=t&&typeof t.scale=="number"?t.scale:t&&t.img&&typeof t.img.scale=="number"?t.img.scale:1,c=Ce(r)*s,f=typeof t._hR=="number"?t._hR:Math.round(c),m=.1,d=f;(c>f+m||c<f-m)&&(d=Math.round(c)),t._hR=d;let w=d,b=t.img,G=b&&b.width&&b.height?b.width/b.height:1,u=Math.max(1,Math.round(w*G)),h=w/S,T=(t.floorBias??0)*s*h*(2-B0),X=Math.min(.9,Math.max(.2,s)),W=t.ground?Te(w,T,X):ve(w),O=Math.round(i-(u>>1)),H=O+u;return{drawStartX:O,drawEndX:H,drawStartY:W.startY,drawEndY:W.endY,depth:r,size:w,width:H-O}}function G0(t,e,o=1){let n=t.trim().split(`
`).map(d=>d.replace(/\s+/g,"")),a=n.length-1;for(;a>=0&&n[a].split("").every(d=>d===".");)a--;a>=0&&a<n.length-1&&(n=n.slice(0,a+1));let r=n.length,i=n[0].length,s=1,c=document.createElement("canvas");c.width=i,c.height=r;let f=c.getContext("2d");f.imageSmoothingEnabled=!1;let m=f.createImageData(i,r);for(let d=0;d<r;d++)for(let w=0;w<i;w++){let b=n[d][w],G=(d*i+w)*4;if(b==="."){m.data[G+3]=0;continue}let u=e[b]||"#ffffff",h=parseInt(u.slice(1),16);m.data[G]=h>>16&255,m.data[G+1]=h>>8&255,m.data[G+2]=h&255,m.data[G+3]=255}if(f.putImageData(m,0,0),o!==1){let d=document.createElement("canvas");d.width=i*o,d.height=r*o;let w=d.getContext("2d");return w.imageSmoothingEnabled=!1,w.drawImage(c,0,0,d.width,d.height),d.baseline=s,d.scale=o,d}return c.baseline=s,c.scale=1,c}async function Re(t,e){return await Ie(t,e,1)}async function Ie(t,e=1,o=1){let n=`../assets/gfx/${t}`;return new Promise((a,r)=>{let i=new Image;i.onload=()=>{let s=document.createElement("canvas"),c=i.width,f=i.height;s.width=c*e,s.height=f*e;let m=s.getContext("2d");m.imageSmoothingEnabled=!1,m.drawImage(i,0,0,s.width,s.height),s.baseline=o,s.scale=e,a(s)},i.onerror=()=>r(new Error(`Failed to load sprite: ${n}`)),i.src=n})}var i0,T0,v0,R0,I0,q0;async function Pt(){T0=T0=G0(`
  ................................
  ..............BB..BB............
  .............BbbbbbbB...........
  ...........BbbbGGGGbbbB.........
  ..........BbbbGGGGGGbbbB........
  .........BbbGGGGGGGGGGbbB.......
  ........BbbGGGgGGGGgGGbbB.......
  ........BbbGGgGyyGgGGGbbB.......
  .......BbbGGGGGGGGGGGGbbB.......
  .......BbbGGGGGGGGGGGGbbB.......
  ......BbbGGGGGGGGGGGGGGbbB......
  ......BbbGGGGgGGGGgGGGGbbB......
  ......BbbGGGGwwwwwwGGGGbbB......
  .....BbbGGGwwwWWkWWwwwGGbbB.....
  .....BbbGGGwwwwkkwwwwGGbbB......
  .....BbbGGGwwwwrwwwwGGGbbB......
  .....BbbGGGwwwwwwwwwGGGbbB......
  .....BbbGGGGwwwwwwwGGGGbbB......
  .....BbbGGGGGGGGGGGGGGGbbB......
  .....BbbGGGGGGGGGGGGGGGbbB......
  ......BbbGGGGGGGGGGGGGbbB.......
  ......BbbGGGGGGGGGGGGGbbB.......
  .......BBbbbgggGGGGgggbbBB......
  ........BBBbbbbbbbbbbbbBBB......
  ................................
  `,{B:"#2c1810",b:"#5c3d2e",g:"#7a6b5c",G:"#a89080",k:"#080508",w:"#e8e0d5",W:"#f5f0e8",r:"#8b4513",y:"#ffeb9c"},4),q0=G0(`
  ............
  ....bbbb....
  ..bbGGGGbb..
  .bssssssssb.
  .bGGgGGgGGb.
  .bssssssssb.
  .bGgGGGGgGb.
  .bssssssssb.
  .bGGgGGgGGb.
  .bssssssssb.
  .bGgGGGGgGb.
  .bssssssssb.
  .bGGgGGgGGb.
  .bssssssssb.
  .bGGgGGgGGb.
  .bssssssssb.
  ..bbGGGGbb..
  ....bbbb....
  ............
  ............
  `,{k:"#0a0f10",g:"#FA5053",G:"#CD1C18",s:"#950606",b:"#0e1620"},3),R0=G0(`
  ................
  .....B....B.....
  ....BBBBBBBB....
  ...BBbBBbBBB....
  ...BBbgBgbBB....
  ....BBgggBB.....
  .....kGGGk......
  ....kGGsGGk.....
  ...kGGGGGGGk....
  ...kGGGGGGGk....
  ....kGGGGGk.....
  .....kGGGk......
  .......GG.......
  .......GG.......
  .....GGGGGG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GG..GG.....
  .....GGggGG.....
  `,{k:"#5a4500",g:"#FFD700",G:"#FFA500",s:"#FFF5CC",b:"#4169E1",B:"#87CEEB"},4),v0=G0(`
  ............r...
  ............rr..
  ...........w..r.
  .......sb.w...rr
  .......bdw...w..
  .......sfd..w...
  ......sfffdw....
  .....sfffffdb...
  ....sfbffffss...
  ...sfbfbffs.....
  ..sfbfbfbs......
  .sfbfbfbs.......
  .sffbfbs........
  ..sffbs.........
  ...sss..........
  ................
  `,{b:"#100904",d:"#8f715b",f:"#5a3b1a",r:"#DC143C",s:"#000000",w:"#4d260a"},3),i0=i0=G0(`
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ................................................................
  ........................................................w.......
  ......................................................sww.......
  ..................................................wwwwws........
  ...............................................wwwwwwww.s.......
  ..............................................wwwwww....s.......
  ...........................................wwwwwww......s.......
  ...........................................wwwww........s.......
  ..........................................wwwww..........s......
  .........................................wwwww...........s......
  ........................................wwwwww...........s......
  ........................................wwwww............s......
  .......................................wwwww.............s......
  .......................................wwwww.............s......
  .......................................wwww...............s.....
  ......................................wwwww...............s.....
  ......................................wwww................s.....
  .....................................wwwww................s.....
  .....................................wwwww................s.....
  .....................................wwww.................s.....
  .....................................wwww.................s.....
  ....................................wwwww.................s.....
  ....................................wwww..................s.....
  ....................................wwww..................s.....
  ..............................ssss.wwwww..................s.....
  ..............................sss..wwww...................s.....
  ..............................s.bb.wwww....................s....
  ..............................s..bbwwww....................s....
  ..................................bwwww....................s....
  ..................................bbwww....................s....
  ...................................bbww....................s....
  ..................................wwbbww...................s....
  ..................................wwwbbb....................s...
  ..................................wwwwwbb...................s...
  ...................................wwwwwbb..................s...
  ....................................wwww.bb.................s...
  ....................................wwww..bbb...............s...
  ....................................wwww....bb..............s...
  ....................................wwww.....bb..............s..
  ....................................wwww......bb.............s..
  ...................................wwwww.......bb............s..
  ..................................wwwwww........bbb..........s..
  ..................................wwwwww.........bbb.........ss.
  ..................................wwwwww...........bbrrrrr....s.
  ..................................wwwwww...........fbbbrrrr...s.
  ...................................wwwww...........ffffbbrrr..s.
  ...................................wwwwww...........ffffbbrrr.s.
  ...................................wwwwww...........ffffffbb.ss.
  ...................................wwwwww.............ffff.bbbs.
  ...................................wwwwwww..............ff...bs.
  `,{b:"#5a3b1a",f:"#B8860B",r:"#DC143C",s:"#C0C0C0",w:"#8B4513"},3),I0=await Re("apple.png",3)}var M=[];function Q(t,e){if(t<0||e<0||t>=p.MAP_W||e>=p.MAP_H)return!0;let o=p.MAP[e|0][t|0];return o===0||o===5?!1:o===7?!l.hasBlueKey:o!==6}function $0(t,e,o){return!!(Q(t,e)||Q(t-o,e)||Q(t+o,e)||Q(t,e-o)||Q(t,e+o))}function k0(t){if(!Array.isArray(t)||t.length===0)throw new Error("Array must be non-empty.");let e=F(t.length)-1;return t[e]}function F(t){if(t<=0)throw new Error("The maximum value must be greater than 0.");return Math.floor(Math.random()*t)+1}function P0(t,e,o){return t+(e-t)*o}var y=null,o0=null,I=null,V0=null,Dt=null;function K0(){y||(y=new(window.AudioContext||window.webkitAudioContext))}function R({freq:t=440,dur:e=.1,type:o="square",vol:n=.2,slide:a=0}){if(!y)return;let r=y.createOscillator(),i=y.createGain();r.type=o,r.frequency.value=t,i.gain.value=n,r.connect(i).connect(y.destination);let s=y.currentTime;a&&(r.frequency.setValueAtTime(t,s),r.frequency.linearRampToValueAtTime(t+a,s+e)),i.gain.setValueAtTime(n,s),i.gain.exponentialRampToValueAtTime(.001,s+e),r.start(s),r.stop(s+e)}function z0({dur:t=.2,vol:e=.2,lp:o=1200}){if(!y)return;let n=y.createBuffer(1,y.sampleRate*t,y.sampleRate),a=n.getChannelData(0);for(let f=0;f<a.length;f++)a[f]=Math.random()*2-1;let r=y.createBufferSource(),i=y.createGain(),s=y.createBiquadFilter();r.buffer=n,i.gain.value=e,s.type="lowpass",s.frequency.value=o,r.connect(s).connect(i).connect(y.destination);let c=y.currentTime;r.start(c),r.stop(c+t)}var k={shot:()=>{let t=F(50),e=-F(50);R({freq:220+t+e,dur:.05+F(3)/100,type:"square",vol:.25,slide:120}),z0({dur:.03+F(3)/100,vol:.15,lp:800})},pickup:()=>{R({freq:880,dur:.06,type:"triangle",vol:.2}),R({freq:1180,dur:.08,type:"triangle",vol:.18})},explode:()=>{z0({dur:1,vol:.3,lp:800}),R({freq:90,dur:.7,type:"sawtooth",vol:.12,slide:-60})},hurt:()=>{R({freq:140,dur:.12,type:"sawtooth",vol:.2,slide:-50})},killedEntity:()=>{let t=Math.random()*16-8;R({freq:320+t,dur:.26,type:"triangle",vol:.3,slide:-220}),R({freq:480+t,dur:.22,type:"sawtooth",vol:.1,slide:-260}),R({freq:90,dur:.08,type:"sine",vol:.18}),z0({dur:.05,vol:.1,lp:1e3}),setTimeout(()=>{R({freq:170+t,dur:.07,type:"triangle",vol:.16,slide:70})},90)},door:()=>{R({freq:420,dur:.12,type:"square",vol:.15})},portal:()=>{R({freq:600,dur:.5,type:"sawtooth",vol:.2}),R({freq:400,dur:.3,type:"sawtooth",vol:.2,slide:50}),R({freq:600,dur:.5,type:"sawtooth",vol:.2})}};async function ke(t,{volume:e=.15}={}){if(y)try{if(!V0||t!==Dt){let n=await(await fetch(t,{cache:"force-cache"})).arrayBuffer();V0=await y.decodeAudioData(n),Dt=t}Ot(),I=y.createBufferSource(),I.buffer=V0,I.loop=!0,o0=y.createGain(),o0.gain.value=e,I.connect(o0).connect(y.destination),I.start()}catch(o){try{Ot();let n=new Audio(t);n.loop=!0,n.volume=Math.max(0,Math.min(1,e)),await n.play(),I={stop:()=>n.pause(),disconnect:()=>{}},o0=null}catch(n){}}}function Ot(){try{I&&I.stop(0)}catch(t){}if(I&&I.disconnect)try{I.disconnect()}catch(t){}if(o0)try{o0.disconnect()}catch(t){}I=null,o0=null}var Ht=!1;async function U0(){if(!y||I||Ht)return;Ht=!0,await ke("../assets/sfx/HexenST02SLowed.ogg",{volume:.12})}var j0=0,P=new Set,Q0=!1,J0=0,Z0=!1;function Yt(t){window.addEventListener("keydown",e=>{P.add(e.code),K0(),U0(),e.code==="Space"&&(e.preventDefault(),_t()),e.code==="KeyM"&&(e.preventDefault(),L.classList.toggle("visible"))}),window.addEventListener("keyup",e=>P.delete(e.code)),t.addEventListener("mousedown",e=>{e.button===0&&_t(),Q0=!0,J0=e.clientX,K0(),U0()}),window.addEventListener("mouseup",()=>Q0=!1),window.addEventListener("mousemove",e=>{if(Q0){let o=e.clientX-J0;J0=e.clientX,l.a+=o*.0035}}),Mt.onclick=()=>He(),Bt.onclick=()=>L.classList.toggle("visible")}function Xt(t){let e=P.has("ShiftLeft")||P.has("ShiftRight"),o=l.speed*(e?2:1)*t,n=l.rotSpeed*t,a=Math.cos(l.a),r=Math.sin(l.a),i=-r,s=a,c=0,f=0;P.has("ArrowLeft")&&(l.a-=n),P.has("ArrowRight")&&(l.a+=n),(P.has("ArrowUp")||P.has("KeyW"))&&(c+=a*o,f+=r*o),(P.has("ArrowDown")||P.has("KeyS"))&&(c-=a*o,f-=r*o),P.has("KeyA")&&(c-=i*o,f-=s*o),P.has("KeyD")&&(c+=i*o,f+=s*o);let m=l.x+c,d=l.y+f;$0(m,l.y,W0)||(l.x=m),$0(l.x,d,W0)||(l.y=d)}function _t(){let t=!1;l.ammo>0&&(l.ammo--,Y(),k.shot(),t=!0);let e=A0(),o=Pe(e);if(!o){t||x("No arrows. Look for quivers.");return}switch(o.type){case"key":o.alive=!1,l.hasBlueKey=!0,k.door(),x("Keycard found! Find the exit!"),qt();break;case"food":{o.alive=!1;let n=l.health>=l.maxHealth;n&&(l.maxHealth+=1),l.health=r0(l.health+h0,0,l.maxHealth),x(n?"Ranger Became Stronger.":"Health restored."),Y(),k.pickup();break}case"arrows":o.alive=!1,l.ammo=Math.min(60,l.ammo+p0),Y(),x(`Arrows +${p0}`),k.pickup();break;default:o.onHit&&o.onHit(o,t);break}}function Wt(){for(let t of M)if(!(!t.alive||Math.hypot(t.x-l.x,t.y-l.y)>=.6))switch(t.type){case"key":t.alive=!1,l.hasBlueKey=!0,k.door(),x("Keycard found! Find the exit!"),qt();break;case"food":t.alive=!1,l.health>=l.maxHealth?(x("Ranger Became Stronger"),l.maxHealth+=1,l.health=r0(l.health+h0,0,l.maxHealth)):(l.health=r0(l.health+h0,0,l.maxHealth),x(`Health +${h0}`)),Y(),k.pickup();break;case"arrows":t.alive=!1,l.ammo=Math.min(60,l.ammo+p0),Y(),k.pickup(),x(`Arrows +${p0}`);break;default:t.onTouch&&t.onTouch(t);break}}function Nt(){if(Z0)return;let t=l.x|0,e=l.y|0;p.MAP[e][t]===5&&(k.portal(),x(`Floor ${V} cleared.`),N0(V+1),Z0=!0,setTimeout(()=>{Oe(!0),Z0=!1},100))}function Pe(t){let o=document.getElementById("view").width>>1|0,n=j[o]||1e9,a=null,r=1e9;for(let i of M){if(!i.alive)continue;let s=F0(i,t);s&&(E>0&&s.depth>E||o>=s.drawStartX&&o<s.drawEndX&&s.depth<n+.1&&s.depth<r&&(a=i,r=s.depth))}return a}function y0(t=2){let e=0;for(;e++<200;){let o=(Math.random()*(p.MAP_W-2)|0)+1,n=(Math.random()*(p.MAP_H-2)|0)+1;if(p.MAP[n][o]!==0)continue;let a=o+.5-l.x,r=n+.5-l.y;if(!(Math.hypot(a,r)<t))return{x:o,y:n}}return{x:9,y:9}}function qt(){let t=p.MAP_W,e=p.MAP_H;for(let o=0;o<e;o++)for(let n=0;n<t;n++)p.MAP[o][n]===7&&(p.MAP[o][n]=0)}function $t(){let t=N.x,e=N.y;for(let o=e-1;o<=e+1;o++)for(let n=t-1;n<=t+1;n++)n===t&&o===e||(p.MAP[o][n]=7)}function Vt(t){let{enchantedKey:e,food:o,arrowQuiver:n}=t;if(M.length=0,F(100)<50)for(let s=0;s<F(2)*(p.MAP_H/20|0);s++){let c=y0(1);M.push(nt(A.barrel,{x:c.x+.5,y:c.y+.5}))}let a=y0(4);M.push({x:a.x+.5,y:a.y+.5,img:e,type:"key",alive:!0,dist:0,ground:!0,scale:.25,floorBias:35});let r=y0(3);M.push({x:r.x+.5,y:r.y+.5,img:o,type:"food",alive:!0,dist:0,ground:!0,scale:.25,floorBias:35});for(let s=0;s<1+(V/3|0)*(p.MAP_H/20|0);s++)if(s<=1&&F(100)<50||s<1&&l.ammo<=0&&F(100)<80||F(100)<25){let c=y0(3);M.push({x:c.x+.5,y:c.y+.5,img:n,type:"arrows",alive:!0,dist:0,ground:!0,scale:.25,floorBias:35})}let i=Math.min((2+(V-1)*2)*(p.MAP_H/20|0),8);for(let s=0;s<i;s++){let c=y0(3.5);M.push(nt(A.entity,{x:c.x+.5,y:c.y+.5}))}}function Y(){Gt.style.width=`${l.health/l.maxHealth*100}%`,yt.style.width=`${l.ammo/60*100}%`,xt.textContent=Math.max(0,l.health),Et.textContent=l.ammo}var tt=0,et=0,ot=!1,Lt=!1;function x(t){let e=document.getElementById("gameLog"),o=e?.querySelector(".log-items");if(!o)return;let n=document.createElement("div");n.textContent=t,o.prepend(n),e.classList.contains("collapsed")||requestAnimationFrame(()=>{o.scrollTop=0})}function zt(t){tt>0&&(tt-=t,tt<=0&&(St.textContent=l.hasBlueKey?"Find the exit.":"Find the enchanted key."))}function Kt(){ot||l.health<=0&&(ot=!0,l.speed=0,l.rotSpeed=0,et=2,x("YOU DIED! Soul disconnecting from the node..."))}function Ut(t){ot&&(et-=t,et<=0&&De())}function De(){if(Lt)return;Lt=!0;let t=document.getElementById("game");if(t){let e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.background="#ff0000",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.zIndex="999999",e.style.fontFamily='"Courier New", monospace',e.style.opacity="0",e.style.transition="opacity 2s ease-in",e.innerHTML=`
      <div style="
        background: #000;
        border: 3px solid #04650d;
        color: #20b2db;
        width: 600px;
        max-width: 90vw;
        box-shadow: 0 0 20px #04650d;
        font-family: 'Courier New', monospace;
      ">
        <div style="
          background:#000;
          color: #04650d;
          padding: 8px 15px;
          display: flex;
          justify-content: space-between;
          font-weight: bold;
          font-size: 12px;
        ">
          <span style ="color: #FFFFFF; border: 1px solid #04650d;">Death...</span>
        </div>
        <div style="padding: 20px; min-height: 200px;">
          <div style="margin-bottom: 30px;">
            <div style="text-align: center; color: #FFFFFF; font-size: 32px; margin: 8px 0;">YOU HAVE DIED</div>
          </div>
          <div style="text-align: center; margin-top: 20px;">
            <button id="returnBtn" style="
              background: #000;
              border: 2px solid #04650d;
              color: #04650d;
              padding: 12px 24px;
              font-family: 'Courier New', monospace;
              font-size: 14px;
              font-weight: bold;
              cursor: pointer;
              text-transform: uppercase;
              letter-spacing: 1px;
            ">RETURN TO TERMINAL</button>
          </div>
        </div>
      </div>
    `,document.body.appendChild(e);let o=e.querySelector("#returnBtn");if(o){let n=!1;o.addEventListener("click",a=>{a.preventDefault(),!n&&(n=!0,setTimeout(()=>{window.location.href="../index.html"},100))})}setTimeout(()=>{e.style.opacity="1"},50),t.classList.add("game-paused"),P.clear()}}function rt(t=!1){t&&s0(),l.x=U.x,l.y=U.y,l.a=0,l.hasBlueKey=!1,p.MAP[N.y][N.x]=5,$t(),Vt({enchantedKey:R0,food:I0,arrowQuiver:v0}),Y(),x(`Floor ${V}: Find the keycard.`)}function Oe(t=!1){t&&(j0>=g0.length-1?s0():(j0+=1,s0(j0))),l.x=U.x,l.y=U.y,l.a=0,l.hasBlueKey=!1,p.MAP[N.y][N.x]=5,$t(),Vt({enchantedKey:R0,food:I0,arrowQuiver:v0}),Y(),x(`Floor ${V}: Find the keycard.`)}function He(){N0(1),s0(0),rt()}function jt(t){for(let e of M)e.alive&&e.ai&&e.ai(e,t)}var l0={EXPLOSION:"explosion",SCREEN_FLASH:"screen_flash"},_e={[l0.EXPLOSION]:{lifetime:.5,startRadius:.1,endRadius:1,expansionTime:.4,startOpacity:1,endOpacity:0,primaryColor:{h:30,s:90,l:60},secondaryColor:{h:15,s:85,l:50},glowColor:{h:45,s:100,l:75},fillColor:{h:25,s:80,l:40},ringLineWidth:3,glowLineWidth:2,innerLineWidth:1,renderFunction:$e,ignoreBounds:!1},[l0.SCREEN_FLASH]:{lifetime:.15,startOpacity:.85,endOpacity:0,color:"#ffffff",renderFunction:Ve,ignoreBounds:!0}},x0=[];function Qt(t,e,o,n,a={}){let r=_e[t];if(!r)return console.warn(`Unknown effect type: ${t}`),null;let i={ignoreBounds:!1,type:t,x:e,y:o,radius:n,maxRadius:n,age:0,lifetime:a.lifetime??r.lifetime,opacity:a.startOpacity??r.startOpacity,startOpacity:a.startOpacity??r.startOpacity,endOpacity:a.endOpacity??r.endOpacity,...r,...a};return x0.push(i),i}function Jt(t,e,o,n={}){return Qt(l0.EXPLOSION,t,e,o,n)}function Zt({color:t="#ffffff",duration:e=.15,alpha:o=.85}={}){Qt(l0.SCREEN_FLASH,0,0,1,{lifetime:e,startOpacity:o,endOpacity:0,color:t,ignoreBounds:!0})}function te(t){for(let e=x0.length-1;e>=0;e--){let o=x0[e];o.age+=t;let n=Math.min(o.age/o.lifetime,1);Le(o,n),o.age>=o.lifetime&&x0.splice(e,1)}}function Le(t,e){switch(t.type){case l0.EXPLOSION:Ye(t,e);break;case l0.SCREEN_FLASH:Xe(t,e);break}}function Ye(t,e){t.opacity=P0(t.startOpacity,t.endOpacity,e);let o=Math.min(e/t.expansionTime,1),n=P0(t.startRadius,t.endRadius,o);t.radius=t.maxRadius*n}function Xe(t,e){let o=1-(1-e)*(1-e);t.opacity=P0(t.startOpacity,t.endOpacity,o)}function We(){return x0}function ee(t,e,o,n,a){let r=We();if(r.length!==0){t.save();for(let i of r)Ne(t,i,e,o,n,a);t.restore()}}function Ne(t,e,o,n,a,r){let i=qe(e.x,e.y,o,n,a,r,e.ignoreBounds);!i&&!e.ignoreBounds||e.renderFunction(t,e,i)}function qe(t,e,o,n,a,r,i=!1){let s=t-r.x,c=e-r.y,{dirY:f,dirX:m,planeY:d,planeX:w,invDet:b}=o,G=b*(f*s-m*c),u=b*(-d*s+w*c);return u<=.1&&!i?null:i?{x:n/2,y:a/2,radius:a,depth:u}:{x:n/2*(1+G/u),y:a/2+64,radius:a/u*.5,depth:u}}function $e(t,e,o){let n=o.radius*e.radius,a=performance.now()*.001,r=Math.sin(a*8)*12,i=Math.sin(a*12)*.15+1,s=o.y,c=o.x;t.globalAlpha=e.opacity*.3,t.fillStyle=`hsl(${e.fillColor.h+r*.5}, ${e.fillColor.s}%, ${e.fillColor.l}%)`,t.beginPath(),t.arc(c,s,n*.7,0,2*Math.PI),t.fill(),t.globalAlpha=e.opacity*.5,t.strokeStyle=`hsl(${e.glowColor.h+r}, ${e.glowColor.s}%, ${e.glowColor.l}%)`,t.lineWidth=e.glowLineWidth*1.5,t.beginPath(),t.arc(c,s,n*i,0,2*Math.PI),t.stroke(),t.globalAlpha=e.opacity*.85,t.strokeStyle=`hsl(${e.primaryColor.h+r*.8}, ${e.primaryColor.s}%, ${e.primaryColor.l}%)`,t.lineWidth=e.ringLineWidth,t.beginPath(),t.arc(c,s,n*.9,0,2*Math.PI),t.stroke(),t.globalAlpha=e.opacity*.6,t.strokeStyle=`hsl(${e.secondaryColor.h+r*1.3}, ${e.secondaryColor.s}%, ${e.secondaryColor.l}%)`,t.lineWidth=e.innerLineWidth,t.beginPath(),t.arc(c,s,n*.5,0,2*Math.PI),t.stroke()}function Ve(t,e){if(e.opacity<=0)return;let o=t.canvas.width,n=t.canvas.height;t.save(),t.globalAlpha=e.opacity,t.fillStyle=e.color||"#ffffff",t.fillRect(0,0,o,n),t.restore()}var A=Object.freeze({entity:"entity",barrel:"barrel"}),D0={[A.entity]:{type:A.entity,ground:!0,scale:.66,floorBias:3},[A.barrel]:{type:A.barrel,ground:!0,scale:.5,floorBias:5}};Object.freeze(D0);for(let t in D0)Object.freeze(D0[t]);var O0={[A.entity]:{ai(t,e){if(!t.alive)return;let o=l.x-t.x,n=l.y-t.y,a=Math.hypot(o,n);if(a>.3){let r=.9*e,i=o/a,s=n/a,c=t.x+i*r,f=t.y+s*r;Q(c,t.y)||(t.x=c),Q(t.x,f)||(t.y=f)}a<.6&&t.hurtCD<=0&&(l.health=Math.max(0,l.health-bt)|0,Y(),x("Entity attacks!"),k.hurt(),t.hurtCD=.8,Zt({color:"	#740707",duration:.5}),Kt()),t.hurtCD>0&&(t.hurtCD-=e)},onHit(t,e){e?(t.alive=!1,x(k0(["Entity murdered!","Entity destroyed!","Entity purged!"])),k.killedEntity()):x("No arrows.")},onTouch(t){at(A.entity,1e4)&&x("You hear something like water nearby...")}},[A.barrel]:{onHit(t,e){e?(t.alive=!1,oe(t.x,t.y,2.5),x("Kaboom!"),k.explode()):x("No arrows.")},onTouch(t){at(A.barrel,1e4)&&x("Shooting this barrel may yield useful results...")}}};Object.freeze(O0);for(let t in O0)Object.freeze(O0[t]);var ze=0;function nt(t,e={x:0,y:0},o=void 0){let n=D0[t],a=O0[t],r=Object.assign(Object.create(a),n);switch(r.id=ze++,r.x=e.x,r.y=e.y,r.dist=0,r.alive=!0,r.hurtCD=0,t){case A.entity:r.img=T0;break;case A.barrel:r.img=q0;break}return o&&Object.assign(r,o),r}function oe(t,e,o){Jt(t,e,o);for(let n of M){if(!n.alive)continue;Math.hypot(n.x-t,n.y-e)<o&&(n.type===itemTypes.barrel&&(n.alive=!1,oe(n.x,n.y,2.5)),n.alive=!1)}}function ne(t){C.clearRect(0,0,L.width,L.height);let e=6,o=20,n=2,a=Math.floor(o/2),r=Math.max(0,Math.min((l.x|0)-a,p.MAP_W-o)),i=Math.max(0,Math.min((l.y|0)-a,p.MAP_H-o));L.width=n+o*e+n,L.height=n+o*e+n;for(let d=0;d<o;d++)for(let w=0;w<o;w++){let b=i+d,G=r+w,u=p.MAP[b]?.[G]??0,h="#0c1220";u===1?h="#ECDE60":u===2?h="#707a88":u===3?h="#00e676":u===4?h="#996633":u===5?h="#FFE300":u===6?h=" #3561ff":u===7&&(h="#00FFFF"),C.fillStyle=h,C.fillRect(n+w*e,n+d*e,e-1,e-1)}for(let d of t){if(!d.alive)continue;let w=n+(d.x-r)*e,b=n+(d.y-i)*e;C.fillStyle=d.type===A.entity?"#ffeb9c":d.type===A.barrel?"#CD1C18":d.type==="key"?"#6aa2ff":d.type==="food"?"#7fffd4":(d.type==="arrows","#ffffff"),C.fillRect(w-2,b-2,4,4)}let s=n+(l.x-r)*e,c=n+(l.y-i)*e;C.fillStyle="#e7f3ff",C.beginPath(),C.arc(s,c,2.5,0,wt),C.fill();let f=Math.cos(l.a),m=Math.sin(l.a);C.strokeStyle="#78f3d3",C.beginPath(),C.moveTo(s,c),C.lineTo(s+f*1.5*e,c+m*1.5*e),C.stroke()}var it=performance.now(),re=new Map;function at(t,e){let o=it,n=re.get(t)??0;return o<n?!1:(re.set(t,o+e),!0)}Yt(q);var H0=0;function Ke(t){let e=`FPS: ${Math.round(t)}`;g.save(),g.font="12px monospace",g.textAlign="right",g.textBaseline="top";let o=B-8,n=6,a=g.measureText(e).width+8,r=16;g.fillStyle="rgba(10, 15, 25, 0.6)",g.fillRect(o-a,n-2,a,r),g.strokeStyle="rgba(60, 80, 130, 0.9)",g.strokeRect(o-a+.5,n-2+.5,a-1,r-1),g.fillStyle="#dfe6ff",g.fillText(e,o,n),g.restore()}function s0(t=-1){let e;if(t!==-1){let o=g0[t];o&&(e=o)}else e=k0(g0);N.x=e.exitPos.x,N.y=e.exitPos.y,U.x=e.startPos.x,U.y=e.startPos.y,l.health=l.maxHealth,p.cielingColorFront=e.cielingColorFront||"#6495ED",p.floorColorFront=e.floorColorFront||"#054213",p.cielingColorBack=e.cielingColorBack||"#6495ED",p.floorColorBack=e.floorColorBack||"#03210A",p.MAP=e.mapLayout,p.MAP_W=p.MAP[0].length,p.MAP_H=p.MAP.length,l.x=l.x=e.startPos.x,l.y=e.startPos.y}async function Ue(){await Pt(),await Tt(),s0(0),rt(),l.maxHealth=6+F(6),l.health=l.maxHealth,l.ammo=5+F(5),Y(),requestAnimationFrame(ae)}function je(t){let e=A0();vt(g),Rt(g),It(g),kt(t,e,p.MAP,p.MAP_W,p.MAP_H),Qe(),M.sort((o,n)=>n.dist-o.dist),g.imageSmoothingEnabled=!1,Je(e),eo(),ee(g,e,B,S,l)}function Qe(){for(let t of M){let e=t.x-l.x,o=t.y-l.y;t.dist=e*e+o*o}}function Je(t){for(let e of M){if(!e.alive)continue;let o=F0(e,t);if(!o||E>0&&o.depth>E)continue;let n=Ze(o);to(e,o,n)}}function Ze(t){let e=1/(1+t.depth*.3);if(E>0&&t.depth>E*a0){let a=E*a0,r=Math.min(1,Math.max(0,(t.depth-a)/Math.max(1e-6,E-a)));e*=1-r*.6}let o=[1,.85,.7,.55,.4];return{quantizedShade:o.reduce((a,r)=>Math.abs(r-e)<Math.abs(a-e)?r:a,o[0])}}function to(t,e,o){g.save(),o.quantizedShade<.999&&(g.filter=`brightness(${o.quantizedShade})`);let n=Math.max(1,(e.width??e.drawEndX-e.drawStartX)|0),a=e.drawStartY,r=e.drawEndY-e.drawStartY,i=f=>(f-e.drawStartX)*t.img.width/n|0,s=-1,c=0;for(let f=e.drawStartX;f<=e.drawEndX;f++){let d=f>=0&&f<B&&f<e.drawEndX&&e.depth<=j[f];if(d&&s===-1&&(s=f,c=i(f)),(!d||f===e.drawEndX)&&s!==-1){let w=f,b=w-s,G=i(w);G<=c&&(G=c+1);let u=Math.min(t.img.width-c,G-c);b>0&&u>0&&r>0&&g.drawImage(t.img,c,0,u,t.img.height,s,a,b,r),s=-1}}g.restore()}function eo(){let t=Math.round(B*.42),e=Math.round(t*(i0.height/i0.width)),o=Math.max(8,B*.02|0),n=B*.8-t-o,a=S-e-o+20;g.drawImage(i0,n,a,t,e)}function ae(t){let e=Math.min(.05,(t-it)/1e3);it=t;let o=e>0?1/e:0;H0=H0?H0*.9+o*.1:o,Xt(e),jt(e),te(e),Wt(),je(t/1e3),L.classList.contains("visible")&&ne(M),Nt(),zt(e),Ut(e),Ke(H0),requestAnimationFrame(ae)}await Ue().catch(console.error);export{s0 as ChangeMapLevel,at as tryCooldown};
